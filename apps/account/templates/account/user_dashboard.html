{% extends "base.html" %}

{% load humanize i18n %}
{% load timezone_filters %}
{% load django_static %}

{% block head %}
  <link rel="alternate" type="application/atom+xml" title="Notices Feed" href="{% url notification_feed_for_user %}" />
{% endblock %}

{% block css %}
  <link rel="stylesheet" type="text/css" href="/css/user_dashboard.css" media="screen, projection" />
{% endblock %}

{% block content %}

<div class="grid_2">
  <img src="{{ user.get_profile.avatar.avatar_image.url }}" alt="Avatar"/>
</div>
<div class="grid_5">

  <h1>Welcome, 
  {% if user.firstname %}
    {{ user.firstname }}
  {% else %}
    {{ user.username }}
  {% endif %}
  </h1>
</div>

<div class="clear"></div>

<a href="{% url account:edit user %}" class="button-tip minibutton btn-download" title="Edit your informations"><span><span class="icon"></span>Edit your informations</span></a>


<h3>Your bands</h3>

{% if not user.band_memberships.all %}
  You are not part of a band, you may <a href="{% url band:create %}">create one</a>.
{% endif %}

<ul>
  {% for membership in user.band_memberships.all %}
  <li><a href="{% url band:detail membership.band.slug %}">{{ membership.band.name }}</a></li>
  {% endfor %}
</ul>

<h3>Your notifications</h3>

( <a href="{% url notification_notices %}">Settings</a> )

<a href="{% url notification_mark_all_seen %}">{% trans "Mark all unseen notices seen" %}</a>
        
{# TODO: get timezone support working with regroup #}
{% regroup notices by added.date as notices_by_date %}

{% for date in notices_by_date %}
<h2 class="notice_date">{{ date.grouper|naturalday:_("MONTH_DAY_FORMAT")|capfirst }}</h2>

{% if notices %}

{% for notice in date.list %}

{% if notice.is_unseen %}
  <div class="unseen_notice">
{% else %}
  <div class="notice">
{% endif %}

     <span class="notice_type">[{% trans notice.notice_type.display %}]</span>
     <span class="notice_message">{{ notice.message|safe }}</span>
     <span class="notice_time">{{ notice.added|localtime:user.get_profile.timezone|time:"P" }}</span>
  </div>
{% endfor %}
  
{% else %}
  <p>{% trans "No notices." %}</p>
{% endif %}

{% endfor %}
  

  
{% endblock %}
