{% extends "bands/base.html" %}

{% load i18n %}
{% load django_static %}
{% load activity_tags %}
{% load avatar_tags %}

{% block title %}
  {{ band.name }} - {% trans "Dashboard" %}
{% endblock %}

{% block css %}
  {{ block.super }}
  <link rel="stylesheet" type="text/css" media="screen" href="/css/calendar.css" media="screen, projection" />
{% endblock %}

{% block band_content %}

<div class="grid_15 alpha omega">

  <div class="grid_3 alpha">
    <div id="my-band" class="grid_3 alpha omega">
      <a href="{% url band:edit band.slug %}" class="button-tip minibutton btn-edit" title="Edit"><span><span class="icon"></span>{% trans "Edit Band Infos" %}</span></a>
    </div>

    <div id="recent-visitors" class="grid_3 alpha omega">
      <h3>{% trans "Recent visitors" %} (WIP)</h3>
      <ul>
	<li>{% blocktrans %}You'll see here <strong>Bands</strong> and <strong>Venues</strong> that have visited your profile{% endblocktrans %}</li>
      </ul>
    </div>


    <div class="grid_3 alpha omega">
      <h3>{% trans "Advertising" %}</h3>

      <img src="{{ MEDIA_URL }}/images/GuitarXpertsSKY.gif">
    </div>
  </div>

  <div class="grid_8">
    
    {% if today_events %}
    <div class="grid_8 alpha omega">
      <div id="today">
	<h3>{% trans "Today's" %}</h3> 
	<ul>
	  {% for event in today_events %}
	    <li>&rarr; <a href="{{ event.get_absolute_url }}">{{ event.title|capfirst }}</a> (<strong>{{ event.start_time }}</strong>-{{ event.end_time }}) at <a href="{{ event.venue.get_absolute_url }}">{{ event.venue.name|capfirst }}</a></li>
	  {% endfor %}
	</ul>
      </div>
    </div>
    {% endif %}

    <div id="gigbargains" class="grid_8 alpha omega">
      <div class="sectionbox">
	<div class="header">
	  <img src="{% staticfile '/images/gigbargain/negociation_ico.png' %}" alt="bargains"/>
	  <h2>{% trans "Gig Bargains" %} (WIP)</h2>
	  <a href="{% url venue:search %}" class="button-tip minibutton" title="{% trans "Book A Venue" %}"><span><span class="icon"></span>{% trans "Book A Venue" %}</span></a>
	</div>
	<div class="separator"></div>
	<div class="content ">

	  <div class="grid_8 alpha omega">
	    <h3>{% trans "Invitations" %}</h3>
	    <ul>
	      {% for gigbargain in gigbargain_invitations %}
		<li><a href="{% url gigbargain:gigbargain-detail gigbargain.uuid %}">{{ gigbargain.venue.name|capfirst }}, {{ gigbargain.date }} ({% blocktrans with gigbargain.date|timeuntil as time_until %}in {{ time_until }}{% endblocktrans %})</a></li>
		{% empty %}
		{% trans "You don't have any invitation." %}
	      {% endfor %}
	    </ul>

	    <h3>{% trans "Drafts" %}</h3>
	    <ul>
	      {% for gigbargain in gigbargain_drafts %}
		<li><a href="{% url gigbargain:gigbargain-detail gigbargain.uuid %}">{{ gigbargain.venue.name|capfirst }}, {{ gigbargain.date }} ({% blocktrans with gigbargain.date|timeuntil as time_until %}in {{ time_until }}{% endblocktrans %})</a></li>
		{% empty %}
		{% trans "You haven't started any draft." %}
	      {% endfor %}
	    </ul>
	    
	    <h3>{% trans "Being negociated" %}</h3>
	    <ul>
	      {% for gigbargain in band.gigbargains.inprogress_gigbargains|slice:":2" %}
		<li><a href="{% url gigbargain:gigbargain-detail gigbargain.uuid %}">{{ gigbargain.venue.name|capfirst }}, {{ gigbargain.date }} ({% blocktrans with gigbargain.date|timeuntil as time_until %}in {{ time_until }}{% endblocktrans %})</a></li>
		{% empty %}
		{% trans "You don't have any gig bargain in progress." %}
	      {% endfor %}
	    </ul>
	  </div>

	  <div class="more">
	    &rarr; <a href="{% url gigbargain:gigbargain-band-dashboard band.slug %}">{% trans "Gig Bargains Dashboard" %}</a>
	  </div>

	  <div class="clear"></div>

	</div>
      </div>
    </div>


    <div id="agenda" class="grid_8 alpha omega">
      <div class="sectionbox">

	<div class="header">
	  <img src="{% staticfile '/images/gigbargain/calendar_ico.png' %}" alt="calendar"/>
	  <h2>{% trans "Agenda" %} (WIP)</h2>
	  <a href="{% url event:gig-new band.slug %}" class="minibutton" title="New Gig"><span><span class="icon"></span>{% trans "Add Gig" %}</span></a><br>
	</div>

	<div class="separator"></div>

	<div class="content">
	  
	  <div id="calendar">
	    {{ monthly_calendar.toHTML|safe }}
	  </div>

	  <div class="clear"></div>
	  
	  <div class="more">
	    &rarr; <a href="{% url event:band-calendar band.slug %}">{% trans "Calendar" %}</a>
	  </div>
	</div>

      </div>
    </div>
  </div>

  <div class="grid_4 omega">
    <div class="grid_4 alpha omega">
      <div id="band-tip">
	<strong>{% trans "Tip of the day" %} (WIP)</strong>
	<p>
	{% blocktrans %}Have you filled your PressKit ? This is the best way to get booked !{% endblocktrans %}
	</p>
	<p>
	  {% url import_contacts as import_url %}
	  {% blocktrans with import_url as url %}Extend your network, <a href="{{ url }}">invite your friends</a>.{% endblocktrans %}
	</p>
	<p>
	  <a href="{% url oauth_access_login "twitter" %}?next={% url band:socialnet-associate band.slug %}">Associate your twitter account</a> to be able to post there.
	  <a href="{% url oauth_access_login "facebook" %}?next={% url band:socialnet-associate band.slug %}">Associate your facebook account</a> to be able to post there.
	</p>
      </div>
    </div>


    <div id="upcoming_events" class="grid_4 alpha omega">
      <h3>{% trans "Upcoming events" %}</h3>
      {% with future_events|slice:":2" as upcoming_events %}

	{% if not upcoming_events %}
	  {% trans "You don't have any upcoming event." %} 
	  <a href="{% url venue:search %}">{% trans "Start booking a venue now !" %}</a>
	{% else %}
	  <ul>
	    {% for event in future_events|slice:":2" %}
	      <li>
		<a href="{{ event.get_absolute_url }}">{{ event|capfirst }}</a>
	      </li>
	    {% endfor %}
	  </ul>
	{% endif %}
      {% endwith %}
    </div>

    <div id="suggestions">
      <h3>{% trans "Suggestions" %} (<acronym title="{% trans "Work in progress, don't expect it to work :)" %}">WIP</acronym>)</h3> 
      {% blocktrans %}You have to gig more before we can suggest you :{% endblocktrans %}
      <ul>
	<li>{% trans "<strong>Bands</strong> that are like you, in your area or not, with whom you can plan gigs ;" %}</li>
	<li>{% trans "<strong>Venues</strong> that are used to receive bands like you, where you can play with a good public." %}</li>
    </div>

    <div id="bandmembers" class="grid_4 alpha omega">
      <h3>{% trans "Members" %} ({{ band.band_members.count }})</h3>
      <a href="{% url band:membership-manage band.slug %}" class="minibutton" title="Manage members"><span><span class="icon"></span>{% trans "Manage" %}</span></a>

      <ul>
	{% for member in band.band_members.all %}
	<li>
	  {% avatar member.user 48 %}
	  <a href="{{ member.user.get_profile.get_absolute_url }}">{{ member.user.get_full_name|default:member.user.username }}</a> ({{ member.user.username }})
	  <span class="bandmember_role" title="{{ member.roles.all|join:', ' }}">{{ member.roles.all|join:', '|truncatewords:3 }}</span>
	</li>
	{% endfor %}
      </ul>


    </div>
  </div>
</div>

{% endblock %}
