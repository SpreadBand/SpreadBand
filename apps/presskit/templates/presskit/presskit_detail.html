{% extends 'base.html' %}

{% load elsewhere_tags %}
{% load oembed_tags %}
{% load reviews_tags %}
{% load django_static  %}
{% load markup %}

{% block css %}
<link rel="stylesheet" type="text/css" href="/css/ghbuttons.css" media="screen, projection" />
<link rel="stylesheet" type="text/css" href="/css/presskit.css" media="screen, projection" />
<link rel="stylesheet" type="text/css" href="/css/jquery/galleryview/galleryview.css" media="screen, projection" />
{% endblock %}

{% block javascript %}
{{ block.super }}

{% staticall %}
<script type="text/javascript" src="/js/jquery/jquery.timers-1.2.js"></script>
<script type="text/javascript" src="/js/jquery/jquery.easing.1.3.js"></script>
<script type="text/javascript" src="/js/jquery/jquery.galleryview-2.1.1.js"></script>
{% endstaticall %}

<script src="http://www.openlayers.org/api/OpenLayers.js"></script>

<script type="text/javascript">
  var map;

            function init(){
                map = new OpenLayers.Map('map', {controls: []});
	    map.addControl(new OpenLayers.Control.MouseToolbar());

                var layer = new OpenLayers.Layer.OSM()
                map.addLayer(layer);

	    var venue = new OpenLayers.LonLat({{ band.place.geom.x|stringformat:"0.5f" }}, {{ band.place.geom.y|stringformat:"0.5f" }}) // Center of the map
            .transform(new OpenLayers.Projection("EPSG:4326"), // transform from WGS 1984
	    new OpenLayers.Projection("EPSG:900913"));

	    var markers = new OpenLayers.Layer.Markers("Markers")
	    map.addLayer(markers)
	    markers.addMarker(new OpenLayers.Marker(venue));

	    map.setCenter(venue,
	    4 // Zoom level
            );

	    };

	    $(document).ready(init);
</script>


<script type="text/javascript">
$(document).ready(function() {
 $('#gallery').galleryView({
    panel_width: 320,
    panel_height: 300,
    gallery_width: 300,
    gallery_height: 300,
    frame_height: 50,
    frame_width: 90,
    nav_theme: '../../../css/jquery/galleryview/themes/dark',
    transition_interval: 10000,
    pause_on_hover: true,
    paused: true,
    filmstrip_position: 'bottom',
    overlay_position: 'bottom'});

	function changeTrack(e) {
		$("#trackname").text($(this).text());
		$("#audio_player").jPlayer("setFile", $(this).attr("mp3"), $(this).attr("ogg")).jPlayer("play");
		$(this).blur();
		return false;
	};


 $(".track").click( changeTrack );


});
</script>

{% endblock %}


{% block content %}

<div id="presskit-sidebar" class="grid_3 alpha">
  <div id="bandavatar" class="grid_3 alpha omega">
    <img src="{{ band.pictures.avatar.thumbnail_image.url }}" width="172px" alt="band avatar" />
  </div>

  <div id="genres" class="grid_3 alpha omega">
    {% if band.genres %}
      <strong>Genres</strong>: {{ band.genres }}
    {% else %}
      No genre.
    {% endif %}
  </div>

  <div id="influences" class="grid_3 alpha omega">
    {% if band.influences %}
      <strong>Influences</strong>: {{ band.influences }}.
    {% else %}
      No influences.
    {% endif %}
  </div>
  
  <!-- Band members -->
  <div id="bandmembers" class="grid_3 alpha omega">
    <h3>Members ({{ band.band_members.count }})</h3>
    <a href="{% url band:membership-manage band.slug %}" class="button-tip minibutton" title="Edit"><span><span class="icon"></span>Edit</span></a>

    <ul>
      {% for member in band.band_members.all %}
	<li><img src="{{ member.user.get_profile.avatar.small_avatar_image.url }}"><a href="{{ member.user.get_profile.get_absolute_url }}">{{ member.user.get_full_name|default:member.user.username }}</a>
	<span class="bandmember_whois">{{ member.user.get_profile.genre }}, {{ member.user.get_profile.age|default:"-" }} y-o.</span>
	<span class="bandmember_role" title="{{ member.roles.all|join:", " }}">{{ member.roles.all|join:", "|truncatewords:3 }}</span>
      </li>
    {% endfor %}
    </ul>
  </div>

  <!-- Latest gigs -->
  <div id="latest-gigs" class="grid_3 alpha omega">
    <h3>Latest Gigs</h3>
    {% if latest_gigs %}
      <ul>
	{% for gig in latest_gigs %}
	  <li>
	    {{ gig.event_date }}: <a href="{{ gig.get_absolute_url }}">{{ gig.venue.name }}</a>
	  </li>
	{% endfor %}
      </ul>
    {% else %}
      This band has no recent gigs.
    {% endif %}
  </div>

  <!-- Social networks -->
  <div id="socialnets" class="grid_3 alpha omega">
    <h3>Social Networks</h3>
    <a href="{% url band:socialnet-edit band.slug %}" class="button-tip minibutton" title="Edit"><span><span class="icon"></span>Edit</span></a>

    <ul>
      {% for socialnetwork in band.socialnetworks.all %}
	<li>
	  <img src="{{ socialnetwork.network.icon_url }}" alt="{{ socialnetwork.network.name }}" />
	  <a href="{{ socialnetwork.url }}" target="_blank" title="{{ socialnetwork.url }}">{{ socialnetwork.username|capfirst }}</a>
	</li>
      {% endfor %}
    </ul>

  </div>

  <!-- Websites -->
  <div id="websites" class="grid_3 alpha omega">
    <h3>Websites</h3>
    <a href="{% url band:socialnet-edit band.slug %}" class="button-tip minibutton" title="Edit"><span><span class="icon"></span>Edit</span></a>

    <ul>
      {% for website in band.websites.all %}
	<li>
	  <img src="{{ website.icon_url }}" alt="Website" />
	  <a href="{{ website.url }}" target="_blank" title="{{ website.url }}">{{ website.name|capfirst }}</a>
	</li>
      {% endfor %}
    </ul>

  </div>

  <!-- stats -->
  <div id="stats" class="grid_3 alpha omega">
    <h3>A few stats</h3>
    <ul>
      {% if band.founded_on %}
	<li>Active since {{ band.founded_on|date:"M Y" }}</li>
      {% endif %}
      <li>Already played X gigs</li>
      <li>Played with Y other bands</li>
      <li>Played at Z venues</li>
    </ul>
  </div>


</div>

<div id="presskit-main" class="grid_12 omega">
  <h1>PressKit &raquo; <a href="{{ band.get_absolute_url }}">{{ band.name }}</a> ({{ band.city }}, {{ band.country }})</h1>

  <div class="grid_7 alpha">
    <div id="biography" class="sectionbox">
      <div class="header">
	<h2>Biography</h2>
	<a href="{% url band:edit band.slug %}" class="button-tip minibutton" title="Edit"><span><span class="icon"></span>Edit</span></a>
      </div>
      <div class="separator"></div>
      <div class="content">
	{% if band.biography %}
	  {{ band.biography|capfirst|truncatewords:100 }}[<a href="#">Read more</a>]
	{% else %}
	  No biography.
	{% endif %}
      </div>
    </div>
  </div>

  <div class="grid_5 omega">
    <div id="location" class="sectionbox">
      <div class="header">
	<h2>Location</h2>
	<a href="{% url band:edit band.slug %}" class="button-tip minibutton" title="Edit"><span><span class="icon"></span>Edit</span></a>
      </div>
      <div class="separator"></div>
      <div class="content">
	<div style="height: 200px; width: 100%" id="map" class="smallmap"></div>
      </div>
    </div>
  </div>

  <div class="grid_12 alpha omega">
    <div id="tracks" class="sectionbox">
      <div class="header">
	<h2>Featured Tracks</h2>
	<a href="{% url band:edit band.slug %}" class="button-tip minibutton" title="Edit"><span><span class="icon"></span>Edit</span></a>
      </div>
      <div class="separator"></div>
      <div class="content">
	{% if presskit.tracks.count %}
	  <ul>
	    {% for track in presskit.tracks.all %}
	      <li><a class="track" href="#" ogg="{{ track.file.url|urlencode }}">{{ track.title }}</a> {% if track.albumtrack %}(Album: <a href="{{ track.albumtrack.album.get_absolute_url }}">{{ track.albumtrack.album.name }}</a>){% endif %}</li>
	    {% endfor %}
	  </ul>
	{% else %}
	    You have not uploaded any tracks yet. You should do so if you want the venues to book you !
	{% endif %}
      </div>
    </div>
  </div>

  <div class="grid_6 alpha">
    <div id="pictures" class="sectionbox">
      <div class="header">
	<h2>Pictures</h2>
	<a href="{% url band:edit band.slug %}" class="button-tip minibutton" title="Edit"><span><span class="icon"></span>Edit</span></a>
      </div>
      <div class="separator"></div>
      <div class="content">
	<div id="gallery">
	  {% for picture in band.pictures.all %}
	    <div class="panel"><img src="{{ picture.thumbnail_image.url }}" alt="image1" /></div>
	  {% endfor %}
	  
	  <div class="strip_wrapper">
	    <ul class="filmstrip">
	      {% for picture in band.pictures.all %}
		<li><img src="{{ picture.original_image.url }}" alt="hoy joy" title="fuckin' title"/>
		<div class="panel-overlay">
		  <p>Some more information about this photo, perhaps with a <a href="http://some.web.site" target="_blank">link</a> to another page.</p>
		</div>
		</li>
	      {% endfor %}
	    </ul>
	  </div>
	</div>
      </div>
    </div>
  </div>

  <div class="grid_6 omega">
    <div id="video" class="sectionbox">
      <div class="header">
	<h2>Video</h2>
	<a href="{% url band:edit band.slug %}" class="button-tip minibutton" title="Edit"><span><span class="icon"></span>Edit</span></a>
      </div>
      <div class="separator"></div>
      <div class="content">
	{% if presskit.video %}
	  {% oembed 320x240 %}
	  {{ presskit.video }}
	  {% endoembed %}
	{% else %}
	  No video has been uploaded.
	{% endif %}
      </div>
    </div>
  </div>

  <div class="clear"></div>

  <div class="grid_6 alpha">
    <div id="techsheet" class="sectionbox">
      <div class="header">
      <h2>Technical Sheet</h2>
	<a href="{% url band:edit band.slug %}" class="button-tip minibutton" title="Edit"><span><span class="icon"></span>Edit</span></a>
      </div>
      <div class="separator"></div>
      <div class="content">
	{% if band.technical_sheet %}
	  {{ band.technical_sheet|markdown }}
	{% else %}
	  No technical sheet.
	{% endif %}
      </div>
    </div>
  </div>

  <div class="grid_6 omega">
    <div id="reviews" class="sectionbox">
      <div class="header">
	<h2>Latest reviews</h2>
      </div>
      <div class="separator"></div>
      <div class="content">
	({% average_for_instance band %})
	{% reviews_for_instance band %}
      </div>
    </div>
  </div>


</div>

{% endblock %}
