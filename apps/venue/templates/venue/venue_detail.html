{% extends "base.html" %}

{% load elsewhere_tags %}
{% load oembed_tags %}
{% load reviews_tags %}
{% load django_static %}
{% load i18n %}
{% load band_tags %}
{% load event_tags %}

{% block css %}
  {{ block.super }}
  <link rel="stylesheet" type="text/css" media="screen" href="/css/venue_dashboard.css" media="screen, projection" />
  <link rel="stylesheet" type="text/css" media="screen" href="/css/venue.css" media="screen, projection" />
  <link rel="stylesheet" type="text/css" media="screen" href="/css/band_vcard.css" media="screen, projection" />
  <link rel="stylesheet" type="text/css" media="screen" href="/css/calendar.css" media="screen, projection" />
  <link rel="stylesheet" type="text/css" media="screen" href="/css/gig_vevent.css" media="screen, projection" />
  <link rel="stylesheet" type="text/css" media="screen, projection" href="/css/jquery/colorbox/colorbox.css" />
{% endblock %}

{% block javascript %}
  {{ block.super }}

  {% staticall %}
  <script type="text/javascript" src="/js/galleria.js"></script>
  {% endstaticall %}

  <script type="text/javascript" src="http://www.openlayers.org/api/OpenLayers.js"></script>

  <script type="text/javascript">
    var map;
  
    function init(){
    map = new OpenLayers.Map('map', {controls: []});
    map.addControl(new OpenLayers.Control.MouseToolbar());
    map.addControl(new OpenLayers.Control.PanZoomBar());
    
    var layer = new OpenLayers.Layer.OSM()
    map.addLayer(layer);
    
    var venue = new OpenLayers.LonLat({{ venue.place.geom.x|stringformat:"0.5f" }}, {{ venue.place.geom.y|stringformat:"0.5f" }}) // Center of the map
    .transform(new OpenLayers.Projection("EPSG:4326"), // transform from WGS 1984
    new OpenLayers.Projection("EPSG:900913"));
    
    var markers = new OpenLayers.Layer.Markers("Markers");
    map.addLayer(markers);
    markers.addMarker(new OpenLayers.Marker(venue));
    
    map.setCenter(venue,
    14 // Zoom level
    );
    

    };
  
    $(document).ready(init);
  </script>

  <script type="text/javascript">
    $(document).ready(function() {
	// run galleria and add some options
	Galleria.loadTheme('{{ MEDIA_URL }}/css/galleria/themes/classic/galleria.classic.js');

	$('#gallery').galleria({
            image_crop: true, // crop all images to fit
            thumb_crop: true, // crop all thumbnails to fit
            transition: 'fade', // crossfade photos
            transition_speed: 700, // slow down the crossfade
	    autoplay: true,
            data_config: function(img) {
		// will extract and return image captions from the source:
		return  {
                    title: $(img).parent().next('strong').html(),
                    description: $(img).parent().next('strong').next().html()
		};
            },
            extend: function() {
		this.bind(Galleria.IMAGE, function(e) {
                    // bind a click event to the active image
                    $(e.imageTarget).css('cursor','pointer').click(this.proxy(function() {
			// open the image in a lightbox
			this.openLightbox();
                    }));
		});
            }
	});


    });

    $(document).ready(function() {
	$('a.tip').tipsy({gravity: 'e'});
    });

    </script>


{% endblock %}

{% block title %}Venue - {{ venue.name }}
{% endblock %}

{% block content %}

<div id="text">





<div id="venue-sidebar" class="grid_3 alpha">
  <div id="venueavatar" class="grid_3 alpha omega">
    {% if venue.pictures.avatar %}
      <img src="{{ venue.pictures.avatar.thumbnail_image.url }}" width="100%" alt="venue avatar" />
    {% else %}
      <img src="{% staticfile '/images/venue/no_picture.png' %}" width="100%" alt="no venue avatar" />
    {% endif %}
  </div>
  
  
  
  <div class="encart">

  <div id="ambiance" class="">
    {% if venue.ambiance %}
      {% trans "<strong>Ambiance</strong>:" %} {{ venue.ambiance }}
    {% else %}
      {% trans "No ambiance."%}
    {% endif %}
  </div>

  <div id="capacity" class="grid_3 alpha omega">
    {% trans "<strong>Capacity</strong>:" %} {{ venue.capacity|default:"??" }}
  </div>

  <div id="website" class="grid_3 alpha omega">
    {{ venue.websites.all|first|default:"??" }}
  </div>
  
  
  </div>

  <div id="socialnets" class="grid_3 alpha omega">
    
	
	<!--
	<ul>
      {% for socialnetwork in venue.socialnetworks.all %}
	<li>	  
	  <a href="{{ socialnetwork.url }}" target="_blank"><img src="{{ socialnetwork.network.icon_url }}" /></a>
	</li>
      {% endfor %}
    </ul>
	-->
	
	
	<ul>	
		<li>
		
		 <a href="#"><img src="/site_media//images/icons/32x32/facebook.1290786422.png" /></a>
		 <a href="#"><img src="/site_media//images/icons/32x32/facebook.1290786422.png" /></a>
		 <a href="#"><img src="/site_media//images/icons/32x32/facebook.1290786422.png" /></a>
		 <a href="#"><img src="/site_media//images/icons/32x32/facebook.1290786422.png" /></a>
		
		</li>	
	</ul>
	
  </div>

  <!-- Venue members -->
  <div id="venuemembers" class="grid_3 alpha omega">
    <h3>{% trans "Staff" %} ({{ venue.members.count }})</h3>
    {% if is_managed %}
      <a href="{% url band:membership-manage venue.slug %}" class="button-tip minibutton" title="Edit"><span>{% trans "Edit" %}</span></a>
    {% endif %}

    <!--
	
	{% staticfile '/images/account/no_avatar.png' as default_avatar %}
    <ul>
    {% for member in venue.members.all %}
	<li>
	  <img src="{{ member.user.get_profile.avatar.small_avatar_image.url|default:default_avatar }}" width="48px" height="48px"><a href="{{ member.user.get_profile.get_absolute_url }}">{{ member.user.get_full_name|default:member.user.username }}</a>
	  <span class="venuemember_whois">{{ member.user.get_profile.genre|default:"?" }}, {{ member.user.get_profile.age|default:"-" }} y-o.</span>
	  <span class="venuemember_role" title="{{ member.roles.all|join:", " }}">{{ member.roles.all|join:", "|truncatewords:3 }}</span>
      </li>
    {% endfor %}
    </ul>
	
	-->
	
	
    <ul>
	
	<li>
	  <img src="/site_media/avatars/glibersat/resized/48/d832506d9fbf20813cf94538966389a9.jpg" alt="glibersat" height="48" width="48">
	  <a href="/user/glibersat">Guillaume Libersat</a>
	  <span class="venuemember_role" title="Electric Guitar">Electric Guitar</span>

	</li>
	
	<li>
	  <img src="/site_media/avatars/vinz/resized/48/402f043be969852ff3c210a6361eb12c.jpg" alt="vinz" height="48" width="48">
	  <a href="/user/vinz">vinz</a>
	  <span class="venuemember_role" title="Violon">Violon</span>
	</li>
	
      </ul>
	
	
  </div>
  
	<!--
	
	<div id="latest-bands" class="grid_3 alpha omega">
		<h3>{% trans "Latest Bands" %}</h3>
		<ul>
		  {% for band in latest_bands %}
			<li>{% band_vcard band %}</li>
		  {% empty %}
			{% trans "No bands have played there yet." %}
		  {% endfor %}
		</ul>
	</div>
  
	-->




</div>

<script type="text/javascript" src="{% staticfile "/js/jquery/jquery.colorbox.js" %}"></script>

<script type="text/javascript">
$(document).ready(function() {
    $('.presskit-send').colorbox({href: function() { return $(this).attr('href'); },
				  width: '700px',
				  height: '300px',
				  initialWidth: '700px',
				  initialHeight: '300px',
				  transition: 'elastic'
				 });
});
</script>

<div id="venue-main" class="grid_12 omega">
  <h1>{% trans "Venue" %} &raquo; <a href="{{ venue.get_absolute_url }}">{{ venue.name|capfirst }}</a> ({{ venue.city|default:"Somewhere" }}, {{ venue.country|default:"Earth" }})</h1>

  <div class="grid_9 alpha">
    <div id="description" class="">

      <div class="content">
	{% if venue.description %}
	  {{ venue.description|capfirst|safe|truncatewords_html:100 }}[<a href="#">{% trans "Read more" %}</a>]
	{% else %}
	  {% trans "No description." %}
	{% endif %}
	
	{% if is_managed %}
	  <a href="{% url venue:edit venue.slug %}" class="button-tip minibutton btn-edit" title="Edit"><span><span class="icon"></span>{% trans "Edit" %}</span></a>
	{% endif %}
	
      </div>
    </div>
  </div>
  
   <div class="grid_3 omega">
     <div class="sectionbox presskit_sharing">
       
       <div class="venue_sharing_title"><img src="{% staticfile "images/venue/send_presskit.png" %}" alt="Send presskit of" width="150px"/></div>
       
       <ul>
	 {% staticfile '/images/band/no_picture.png' as default_picture %}
	 {% for band in user.bands.all %}
	   <a onclick="javascript: return false;" href="{% url presskit:presskit-send band.slug venue.slug %}" class="presskit-send tip" title="{% blocktrans with band.name as band_name %}Send {{ band_name }} PressKit{% endblocktrans %}">
	     <div>
	       <li>
		 <img width="25px" height="25px" src="{{ band.pictures.avatar.small_avatar_image.url|default:default_picture }}" />
		 <p>{{ band.name }}</p>
	       </li>
	     </div>
	   </a>					
	 {% endfor %} 
       </ul>
       
     </div>
   </div>
				
				

  <!-- Calendar -->
  <!--
  {#
  <div id="venue-calendar" class="grid_12 alpha omega">
    <div class="sectionbox">
      <div class="header">
	<img src="{% staticfile '/images/gigbargain/calendar_ico.png' %}" alt="calendar"/>
	<h2>{% trans "Calendar" %} (WIP)</h2>
      </div>
	
      <div class="separator"></div>

      <div class="content">
	<div id="calendar" class="grid_5 alpha">
	  {{ monthly_calendar.toHTML|safe }}
	</div>
	<div class="grid_6 omega">
	  <h3>{% trans "Upcoming events" %}</h3>
	  <ul id="upcoming-events">
	    {% for event in future_events %}
	      <li class="{% cycle "odd" "even" %}">{% gig_vevent event %}</li>
	    {% empty %}
	      {% trans "No upcoming event." %}
            {% endfor %}
	  </ul>
	</div>

	<div class="grid_12 alpha omega">
	  <div class="more">
	    &rarr; <a href="{% url event:venue-calendar venue.slug %}">{% trans "See full calendar" %}</a>
	  </div>
	</div>
      </div>
      <div class="clear"></div>
    </div>
  </div>
  #}
  -->

  
  <!-- Pictures -->
  <div class="grid_7 alpha">
    <div id="pictures" class="sectionbox">
      <div class="header">
	<img src="{% staticfile '/images/presskit/pictures_ico.png' %}" alt="pictures"/>
	<h2>{% trans "Pictures" %}</h2>
	{% if is_managed %}
	  <a href="{% url venue:edit venue.slug %}" class="button-tip minibutton btn-edit" title="Edit"><span><span class="icon"></span>{% trans "Edit" %}</span></a>
	{% endif %}
      </div>
      <div class="separator"></div>
      <div class="content">
	<div id="gallery" style="height: 300px;">
	  {% for picture in venue.pictures.all %}
	    <a href="{{ picture.original_image.url }}">
	      <img src="{{ picture.thumbnail_image.url }}" alt="image" />
	    </a>
	  {% endfor %}
	</div>
      </div>
    </div>
  </div>

  <div class="grid_5 omega">

	  
	  <div id="video" class="sectionbox">
      <div class="header">
	<img src="{% staticfile '/images/presskit/video_ico.png' %}" alt="video"/>
	<h2>{% trans "Video" %}</h2>
	{% if is_managed %}
	  <a href="{% url venue:edit venue.slug %}" class="modal-popup button-tip minibutton btn-edit" title="Edit"><span><span class="icon"></span>{% trans "Edit" %}</span></a>
	{% endif %}
      </div>
      <div class="separator"></div>
      <div class="fullcontent">
	{% if venue.video %}
	  {% oembed 320x240 %}
	  {{ venue.video }}
	  {% endoembed %}
	{% else %}
	  {% trans "No video has been set." %}
	{% endif %}
      </div>
    </div>
	

	 </div>
	
	<div id="location" class="sectionbox grid_12 alpha omega">
		<div class="header">
			<img src="{% staticfile '/images/presskit/location_ico.png' %}" alt="location"/>
			<h2>{% trans "Location" %}</h2>
			{% if is_managed %}
			<a href="{% url venue:edit venue.slug %}" class="button-tip minibutton btn-edit" title="Edit"><span><span class="icon"></span>{% trans "Edit" %}</span></a>
			{% endif %}
		</div>
      <div class="separator"></div>
      <div class="content">
			{% trans "Address:" %} {{ venue.place.address }}<br/>
			<div style="height: 400px; width: 100%" id="map" class="smallmap"></div>
      </div>
    </div>
	
	
 

  
   <!--  
  <div class="grid_12 alpha omega">
    <div id="location" class="sectionbox">
      <div class="header">
	<img src="{% staticfile '/images/presskit/reviews_ico.png' %}" alt="reviews"/>
	<h2>{% trans "Latest reviews" %} ({% average_for_instance venue %}) (WIP)</h2>
      </div>

      <div class="separator"></div>

      <div class="content">
        {% reviews_for_instance venue %}
      </div>
    </div>
  </div>
  
  
	-->

</div>

</div>

{% endblock %}

