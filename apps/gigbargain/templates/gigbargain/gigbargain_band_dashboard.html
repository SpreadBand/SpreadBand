{% extends 'bands/base.html' %}

{% load activity_tags %}
{% load django_static %}

{% block css %}
  {{ block.super }}
  <link rel="stylesheet" type="text/css" href="/css/gigbargain.css" media="screen, projection" />
  <link rel="stylesheet" type="text/css" href="/css/jquery/jquery.treeview.css" media="screen, projection" />
{% endblock %}

{% block javascript %}
  <script type="text/javascript" src="{% staticfile '/js/jit.js' %}"></script>
  <script type="text/javascript" src="{% staticfile '/js/jquery/jquery.treeview.js' %}"></script>

  <script type="text/javascript">
    $(document).ready(function() {
	// first example
	$("#dash-connections #conlist").treeview({
	    collapsed: false,
	});
    });
  </script>
{% endblock %}

{% block title %}
  {{ band.name }} - Gigbargains
{% endblock %}

{% block band_section %}
  Gigbargains
{% endblock %}

{% block band_content %}


  <div class="grid_12 alpha">

    <!-- Bargains -->
    <div id="dash-gigbargains" class="grid_12 alpha omega">
      <div class="sectionbox bright">
	<div class="header">
	  <img src="{% staticfile '/images/gigbargain/negociation_ico.png' %}" alt="bargains"/>
	  <h2>Bargains</h2>

	  <span>New: {{ new_gigbargains|length }}</span>|
	  <span>In progress: {{ inprogress_gigbargains|length }}</span>|
	  <span>Concluded: {{ concluded_gigbargains|length }}</span>|
	  <span>Aborted: X</span>
	</div>
	<div class="separator"></div>

	<div class="fullcontent">
      
	  <div id="dash-gb-new" class="grid_4 alpha omega">
	    <h3>New</h3>
	    <ul>
	      {% for gigbargain in new_gigbargains %}
		<li>
		  <div>
		    <div>
		      <a href="{{ gigbargain.get_absolute_url }}">{{ gigbargain.date }} - {{ gigbargain.venue.name|capfirst }}</a>
		      with {{ gigbargain.gigbargainband_set.concurring|join:', ' }}.<br/>
		      State : {{ gigbargain.state }}
		    </div>
		  </div>
		</li>
	      {% endfor %}
	    </ul>
	  </div>
	  
	  
	  <div id="dash-gb-progress" class="grid_4 alpha omega">   
	    <h3>In progress</h3>
	    
	    <ul>
	      {% for gigbargain in inprogress_gigbargains %}
		<li>
		  <div>
		    <div>
		      <a href="{{ gigbargain.get_absolute_url }}">{{ gigbargain.date }} - {{ gigbargain.venue.name|capfirst }}</a>
		      with {{ gigbargain.gigbargainband_set.concurring|join:', ' }}.<br/>
		      State : {{ gigbargain.state }}
		    </div>
		  </div>
		</li>
	      {% endfor %}
	    </ul>
	</div>
	  
	<div id="dash-gb-concluded" class="grid_4 alpha omega">
	    
	  <h3>Concluded</h3>
	  
	  <ul>
	    {% for gigbargain in concluded_gigbargains %}
	      <li>
		<div>
		  <div>
		    <a href="{{ gigbargain.get_absolute_url }}">{{ gigbargain.date }} - {{ gigbargain.venue.name|capfirst }}</a>
		    with {{ gigbargain.gigbargainband_set.concurring|join:', ' }}.<br/>
		    State : {{ gigbargain.state }}
		  </div>
		</div>
	      </li>
	    {% endfor %}
	  </ul>
	</div>
	
	<div class="clear"></div>
	
	</div>
      </div>
    </div>


    <div class="grid_12 alpha omega">
      <!-- Calendar -->
      <div id="dash-calendar" class="grid_5 alpha">  
	
	<div class="sectionbox bright">
	  <div class="header">
	    <img src="{% staticfile '/images/gigbargain/calendar_ico.png' %}" alt="calendar"/>
	    <h2>Calendar</h2>
	  </div>
	  
	  <div class="separator"></div>

	  <div class="fullcontent">
	    {{ monthly_calendar.toHTML|safe }}
	  </div>
	    
	</div>
      </div>
	  
      <!-- Repartition -->
      <div id="dash-repartition" class="grid_3">
	<div class="sectionbox bright">
	  <div class="header">
	    <img src="{% staticfile '/images/gigbargain/repartition_ico.png' %}" alt="repartition"/>
	    <h2>Repartition</h2>
	  </div>
	  <div class="separator"></div>
	  <div class="content">
	    
	    <div id="monthly_repartition" style="width: 80%; height: 200px;"></div>
	    
	    <script type="text/javascript">
	      $(document).ready(function() {
		  var pieChart = new $jit.PieChart({  
		      //Where to inject the canvas. Any div container will do.  
		      injectInto: 'monthly_repartition',  
		      //width and height for canvas.  
		      //Default's to the container offsetWidth and Height.  
		      offset: 25,
		      animate: false,  
		      sliceOffset: 1,
		      labelOffset: 15,
		      type: 'stacked:gradient',
		      hoveredColor: '#9fd4ff',
		      Tips: {  
			  enable: true,  
			  onShow: function(tip, elem) {  
			      tip.innerHTML = "<font color='black'><b>" + elem.label + "</b>: " + elem.value + "</font>";  
			  }
		      },
		      Label: { type: 'HTML', color: '#000', size: 11 },

		  });  


		  var json = {  
		      'values': [  
			  {  
			      label: 'New',  
			      values: [{{ monthly_stats.new }}],
			  },
			  {  
			      label: 'In progress',  
			      values: [{{ monthly_stats.inprogress }}],
			  },
			  {  
			      label: 'Concluded',  
			      values: [{{ monthly_stats.concluded }}],
			  },
		      ]}

		  pieChart.loadJSON(json);

	      });
	    </script>

	    <div class="legend">
	      Total = {{ monthly_stats.total }}<br>
	      New = {{ monthly_stats.new }}<br>
	      In progress = {{ monthly_stats.inprogress }}<br>
	      Concluded = {{ monthly_stats.concluded }}
	    </div>
	    
	  </div>
	</div>
      </div>

      <!-- Connections -->
      <div id="dash-connections" class="grid_4 omega">
	<div class="sectionbox bright">
	  <div class="header">
	    <img src="{% staticfile '/images/gigbargain/connection_ico.png' %}" alt="connections"/>
	    <h2>Connections</h2>
	  </div>

	  <div class="separator"></div>

	  <div class="content">

	    <ul id="conlist" class="treeview">
	      <li><span><strong>Bands</strong> ({{ monthly_connections.bands|length }})</span>
	      <ul>
		{% for band in monthly_connections.bands %}
		  <li><a href="{{ band.get_absolute_url }}">{{ band.name }}</a> <img src="{{ band.country.flag }}" title="{{ band.country.name }}, {{ band.city }}" alt="{{ band.country }}"/></li>
		{% empty %}
		  <li>No connection</li>
		{% endfor %}
	      </ul>
	      </li>

	      <li><span><strong>Venues</strong> ({{ monthly_connections.venues|length }})</span>
	      <ul>
		{% for venue in monthly_connections.venues %}
		  <li><a href="{{ venue.get_absolute_url }}">{{ venue.name }}</a> <img src="{{ venue.country.flag }}" title="{{ venue.country.name }}, {{ venue.city }}" alt="{{ venue.country }}"/></li>
		{% empty %}
		  <li>No connection</li>
		{% endfor %}
	      </ul>
	      </li>
	    </ul>

	  </div>
	  
	</div>
      </div>

    </div>

    <div class="grid_12 alpha omega">
      <div class="sectionbox bright">
	<div class="header">
	  <img src="{% staticfile '/images/gigbargain/statistics_ico.png' %}" alt="global stats"/>
	  <h2>Global stats</h2>
	</div>

	<div class="separator"></div>

	<div class="content">

	  <div id="yearly_stats" style="width: 100%; height: 300px;"></div>

	  <script type="text/javascript">
	    var json = {
		label: ['New', 'In progress', 'Concluded'],
		values: [
		    {% for month, data in yearly_values.items %}
		    {
			label: '{{ data.label|date:"M" }}',
			values: [{{ data.new }}, {{ data.inprogress }}, {{ data.concluded }}]
		    },
		    {% endfor %}
		]
	    };

	    $(document).ready(function() {
		var barChart = new $jit.AreaChart({  
		    //id of the visualization container  
		    injectInto: 'yearly_stats',  
		    //whether to add animations  
		    animate: false,  
		    showAggregates: true,
		    //labels offset position  
		    labelOffset: 10,  
		    //area style  
		    type: 'stacked:gradient',
		    //whether to show the aggregation of the values  
		    showAggregates:true,  
		    //whether to show the labels for the bars  
		    showLabels:true,  
		    filterOnClick: true,  
		    restoreOnRightClick:true  ,
		    Margin: {  
			top: 5,  
			left: 5,  
			right: 5,  
			bottom: 5  
		    }, 
		    //labels style  
		    Label: {  
			type: 'HTML', //Native or HTML  
			size: 13,  
			family: 'Arial',
			color: 'black'  
		    },  
		    //add tooltips  
		    Tips: {  
			enable: true,  
			onShow: function(tip, elem) {  
			    tip.innerHTML = "<font color='black'><b>" + elem.name + "</b>: " + elem.value + "</font>";  
			}  
		    }  
		});  
		//load JSON data.  
		barChart.loadJSON(json);  
	    });
	  </script>
	</div>
      </div>
    </div>
  </div>

    <div class="grid_3 omega">

      <div id="latest-activity">
	<h3>Latest activity</h3>

	  <ul>
	    {% for action in latest_activity %}
	      <li>
	    {% if action.target.name %}
	      <span class="title"><strong>{{ action.target.name|capfirst }}</strong> / {{ action.target.date|date:'d M Y' }}</span>
	    {% else %}
	      <span class="title"><strong>{{ action.target.venue.name|capfirst }}</strong> / {{ action.target.date|date:'d M Y' }}</span>
	    {% endif %}
	    
	      {% display_action_short action %}. <span class="date">{{ action.timestamp|timesince }} ago</span></li>
	    {% endfor %}
	  </ul>

	<h2>Alerts</h2>

	<div>

	  <table border=1>
	    <tr>
	      <th>When</th>
	      <th>What</th>
	      <th>New</th>
	    </tr>

	    {% for notice in notices_new %}
	      <tr>
		<td>{{ notice.added }}</td>
		<td>{{ notice.message }}</td>
		<td>{{ notice.unseen|yesno }}</td>
	      </tr>
	    {% endfor %}

	  </table>

	</div>
      </div>
    </div>


  {% endblock %}
