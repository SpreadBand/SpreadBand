{% extends "account/base.html" %}

{% load avatar_crop_tags %}
{% load django_static %}
{% load i18n %}

{% block css %}
{{ block.super }}

<link rel="stylesheet" href="css/avatar/imgareaselect-animated.css" type="text/css" media="screen" charset="utf-8">

<style type="text/css">
        .img_preview {
            border: 1px solid #444;
            overflow: hidden;
            align: left;
        }

        .img_preview img {
            margin:0;
        }

        #picture {
            text-align: center;
        }

        #forms #crop_form.fuzzyform {
            text-align: center;
        }

        #img_small_preview {
            width:36px;
            height:36px;
        }

        #img_small_preview img {
            {{ dim }}:36px;
            padding: 1px;
        }

        #img_big_preview {
            width: 80px;
            height: 80px;
        }

        #img_big_preview img {
            {{ dim }}: 80px;
        }

        #avatar {
        {% ifequal dim "width" %}
            height:{{ AVATAR_CROP_MAX_SIZE }}px;
        {% else %}
            width:{{ AVATAR_CROP_MAX_SIZE }}px;
        {% endifequal %}

            margin-bottom: 10px;
        }
</style>

{% endblock %}

{% block javascript %}
<script type="text/javascript" src="{% staticfile "/js/avatar/jquery.imgareaselect-0.9.2.js" %}"></script>
<script type="text/javascript">
   $(document).ready(function (){
        function adjust(el, selection) {
            var scaleX = $(el).width() / (selection.width || 1);
            var scaleY = $(el).height() / (selection.width || 1);
            $(el+' img').css({
                width: Math.round(scaleX*$('#avatar').width() ) + 'px',
                height: Math.round(scaleY*$('#avatar').height() ) + 'px',
                marginLeft: '-' + Math.round(scaleX * selection.x1) + 'px',
                marginTop: '-' + Math.round(scaleY * selection.y1) + 'px'
            });
        }
        function preview(img, selection) {
            adjust('#img_small_preview', selection);
            adjust('#img_big_preview', selection);
        }
        $('img#avatar').imgAreaSelect({
            aspectRatio: "4:4",
            onSelectEnd:function(img, selection) {
                $('#id_top').val(selection.y1);
                $('#id_left').val(selection.x1);
                $('#id_right').val(selection.x2);
                $('#id_bottom').val(selection.y2);
            },
            onSelectChange: preview
        });

   });
</script>
{% endblock %}

{% block account_content %}

<div id="forms" class="alpha grid_8">
    <div id="picture">
      <img id="avatar" src="{{ avatar.avatar.url }}" alt="Avatar"/>
    </div>
    <form id="crop_form" action="." method="post" class="fuzzyform">
        {{ form.as_p }}
        <input type="submit" value="{% trans "Crop" %}" />
    </form>
</div>
<div id="sidebar" class="grid_4 prefix_1 omega">
  <h2>{% trans "Avatar cropping" %}</h2>
  <p>
  {% blocktrans %}
    Use your mouse to select an area of the picture. You can see a preview of your avatar below this text.
  {% endblocktrans %}
  </p>

  <div class="alpha grid_2">
    <h3>{% trans "Small" %}</h3>
    <div class="img_preview" id="img_small_preview">
      <img src="{{ avatar.avatar.url }}" alt="{% trans "Small preview" %}" />
    </div>
  </div>
  <div class="grid_2 omega">
    <h3>{% trans "Large" %}</h3>
    <div class="img_preview" id="img_big_preview">
      <img src="{{ avatar.avatar.url }}" alt="{% trans "Large preview" %}" />
    </div>
  </div>
</div>
{% endblock %}